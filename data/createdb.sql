DROP SCHEMA IF EXISTS project;

CREATE SCHEMA project;

USE project;

CREATE TABLE PRODUCT_SPEC(
    ProductID 	INT NOT NULL AUTO_INCREMENT,
    Name      	VARCHAR(45),
    Brand     	VARCHAR(20),
    Variety   	VARCHAR(20),
    Category  	VARCHAR(20),
    TypeOfWear 	VARCHAR(20),
    Material  	VARCHAR(20),
    FrontImg  	VARCHAR(100),
    BackImg   	VARCHAR(100),
    Description TEXT,
    PRIMARY KEY(ProductID)
);

CREATE TABLE COLOUR(
    ColourID	INT NOT NULL AUTO_INCREMENT,
    ColourName 	VARCHAR(20),
    ColourCode	CHAR(10),
    PRIMARY KEY(ColourID));
	
CREATE TABLE ITEM(
    ItemID   	INT NOT NULL AUTO_INCREMENT,
    ProductID 	INT NOT NULL,
    ColourID 	INT NOT NULL,
    Size     	VARCHAR(15),
    Price    	FLOAT DEFAULT 0.0,
    QtyInStock 	INT DEFAULT 0,
    PRIMARY KEY(ItemID),
    FOREIGN KEY(ProductID) REFERENCES PRODUCT_SPEC(ProductID)
    ON DELETE RESTRICT ON UPDATE CASCADE,
	FOREIGN KEY(ColourID) REFERENCES COLOUR(ColourID)
	ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE USER_TYPE(
	UserTypeID	INT NOT NULL AUTO_INCREMENT,
	UserType 	VARCHAR(15),
	PRIMARY KEY(UserTypeID)
);
	
CREATE TABLE USER(
	UserID		INT NOT NULL AUTO_INCREMENT,
	Title		VARCHAR(10),
	FirstName	VARCHAR(25),
	LastName	VARCHAR(25),
	Address		VARCHAR(100),
	Email		VARCHAR(45) NOT NULL,
	Password	VARCHAR(20) NOT NULL,
	Telephone	VARCHAR(20),
	Gender		CHAR(1),
	TypeOfWear	VARCHAR(20),
	LastAccess	TIMESTAMP DEFAULT now(),
	UserTypeID	INT NOT NULL DEFAULT 2,
	PRIMARY KEY(UserID),
	FOREIGN KEY(UserTypeID) REFERENCES USER_TYPE(UserTypeID)
	ON DELETE RESTRICT ON UPDATE CASCADE
);

CREATE TABLE ORDERS(
	OrderID		INT NOT NULL  AUTO_INCREMENT,
	UserID		INT NOT NULL,
	DateAndTime	DATETIME DEFAULT now(),
	Subtotal	FLOAT DEFAULT 0.0,
	BillingAdd	VARCHAR(100),
	Status		VARCHAR(15) DEFAULT 'OnCart',
	PRIMARY KEY(OrderID),
	FOREIGN KEY(UserID) REFERENCES USER(UserID)
	ON DELETE RESTRICT ON UPDATE CASCADE
);

ALTER TABLE ORDERS AUTO_INCREMENT = 10000;

CREATE TABLE ORDER_DETAILS(
	OrderID 	INT NOT NULL,
	ItemID 		INT NOT NULL,
	Quantity 	INT,
	UnitPrice 	FLOAT,
	PRIMARY KEY(OrderID,ItemID),
	FOREIGN KEY(ItemID) REFERENCES ITEM(ItemID)
	ON DELETE RESTRICT ON UPDATE CASCADE,
	FOREIGN KEY(OrderID) REFERENCES ORDERS(OrderID)
	ON DELETE RESTRICT ON UPDATE CASCADE
);